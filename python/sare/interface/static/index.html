<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>SARE-HX Â· Cognitive Control Center</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --bg: #0a0b0f;
      --bg2: #111318;
      --bg3: #181b22;
      --glass: rgba(255, 255, 255, 0.04);
      --border: rgba(255, 255, 255, 0.08);
      --cyan: #22d3ee;
      --green: #34d399;
      --purple: #a78bfa;
      --pink: #f472b6;
      --yellow: #fbbf24;
      --red: #f87171;
      --text1: #f1f5f9;
      --text2: #94a3b8;
      --text3: #475569;
      --r: 14px;
      --r2: 10px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0
    }

    body {
      background: var(--bg);
      color: var(--text1);
      font-family: 'Inter', system-ui, sans-serif;
      min-height: 100vh
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 28px;
      height: 52px;
      background: rgba(10, 11, 15, .92);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(12px)
    }

    .logo {
      font-weight: 800;
      font-size: 1rem;
      background: linear-gradient(135deg, var(--cyan), var(--purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent
    }

    .ticker {
      display: flex;
      gap: 16px;
      font-size: 0.72rem;
      color: var(--text2)
    }

    .tick-val {
      font-family: 'JetBrains Mono', monospace;
      color: var(--cyan);
      font-weight: 600
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--green);
      animation: pulse 2s infinite
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1
      }

      50% {
        opacity: .35
      }
    }

    .tab-nav {
      display: flex;
      gap: 2px;
      padding: 12px 22px 0;
      overflow-x: auto;
      scrollbar-width: none;
      background: var(--bg2);
      border-bottom: 1px solid var(--border)
    }

    .tab-nav::-webkit-scrollbar {
      display: none
    }

    .tb {
      padding: 8px 15px;
      border: none;
      background: transparent;
      color: var(--text2);
      font-size: 0.78rem;
      font-weight: 500;
      cursor: pointer;
      border-radius: 8px 8px 0 0;
      border-bottom: 2px solid transparent;
      transition: all .18s;
      white-space: nowrap
    }

    .tb:hover {
      background: var(--glass);
      color: var(--text1)
    }

    .tb.active {
      background: var(--glass);
      color: var(--cyan);
      border-bottom-color: var(--cyan)
    }

    main {
      max-width: 1160px;
      margin: 0 auto;
      padding: 22px
    }

    .tp {
      display: none
    }

    .tp.active {
      display: block
    }

    .g2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px
    }

    .g3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 16px
    }

    .cs2 {
      grid-column: span 2
    }

    .card {
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 18px;
      margin-bottom: 16px
    }

    .card-hd {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px
    }

    .card-title {
      font-weight: 700;
      font-size: 0.88rem
    }

    .sep {
      height: 1px;
      background: var(--border);
      margin: 12px 0
    }

    .sr {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 14px
    }

    .st {
      flex: 1;
      min-width: 80px;
      text-align: center;
      padding: 13px 8px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border);
      border-radius: var(--r2)
    }

    .sv {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.35rem;
      font-weight: 700
    }

    .sl {
      font-size: 0.66rem;
      color: var(--text3);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 4px
    }

    .c-cyan {
      color: var(--cyan)
    }

    .c-green {
      color: var(--green)
    }

    .c-purple {
      color: var(--purple)
    }

    .c-yellow {
      color: var(--yellow)
    }

    .c-red {
      color: var(--red)
    }

    .c-pink {
      color: var(--pink)
    }

    .ir {
      display: flex;
      gap: 8px;
      margin-bottom: 10px
    }

    .inp {
      flex: 1;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid var(--border);
      border-radius: var(--r2);
      padding: 10px 14px;
      color: var(--text1);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      outline: none;
      transition: border .2s
    }

    .inp:focus {
      border-color: var(--cyan)
    }

    .inp::placeholder {
      color: var(--text3)
    }

    .btn {
      padding: 9px 18px;
      border: none;
      border-radius: var(--r2);
      font-weight: 600;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all .18s;
      white-space: nowrap
    }

    .btn-p {
      background: linear-gradient(135deg, #0891b2, #6d28d9);
      color: #fff
    }

    .btn-p:hover {
      opacity: .82;
      transform: translateY(-1px)
    }

    .btn-p.ld {
      opacity: .55;
      cursor: default
    }

    .btn-g {
      background: var(--glass);
      border: 1px solid var(--border);
      color: var(--text2)
    }

    .btn-g:hover {
      color: var(--text1);
      border-color: var(--cyan)
    }

    .btn-sm {
      padding: 5px 11px;
      font-size: 0.73rem
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 12px
    }

    .chip {
      padding: 3px 11px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      color: var(--text2);
      font-size: 0.73rem;
      cursor: pointer;
      transition: all .18s
    }

    .chip:hover {
      background: rgba(34, 211, 238, .1);
      border-color: var(--cyan);
      color: var(--cyan)
    }

    .tc {
      padding: 3px 9px;
      border-radius: 6px;
      background: rgba(34, 211, 238, .08);
      border: 1px solid rgba(34, 211, 238, .2);
      color: var(--cyan);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.68rem
    }

    .tc.concept {
      background: rgba(167, 139, 250, .1);
      border-color: rgba(167, 139, 250, .3);
      color: var(--purple)
    }

    .ebar {
      height: 5px;
      background: rgba(255, 255, 255, .06);
      border-radius: 3px;
      margin: 7px 0
    }

    .efill {
      height: 100%;
      border-radius: 3px;
      background: linear-gradient(90deg, var(--cyan), var(--green));
      transition: width .55s ease
    }

    .pw {
      height: 4px;
      background: rgba(255, 255, 255, .06);
      border-radius: 2px;
      margin-top: 4px
    }

    .pb {
      height: 100%;
      border-radius: 2px;
      background: var(--cyan);
      transition: width .4s
    }

    .badge {
      padding: 2px 8px;
      border-radius: 20px;
      font-size: 0.66rem;
      font-weight: 600
    }

    .b-c {
      background: rgba(34, 211, 238, .12);
      color: var(--cyan);
      border: 1px solid rgba(34, 211, 238, .25)
    }

    .b-g {
      background: rgba(52, 211, 153, .12);
      color: var(--green);
      border: 1px solid rgba(52, 211, 153, .25)
    }

    .b-p {
      background: rgba(167, 139, 250, .1);
      color: var(--purple);
      border: 1px solid rgba(167, 139, 250, .25)
    }

    .b-y {
      background: rgba(251, 191, 36, .1);
      color: var(--yellow);
      border: 1px solid rgba(251, 191, 36, .25)
    }

    .b-r {
      background: rgba(248, 113, 113, .1);
      color: var(--red);
      border: 1px solid rgba(248, 113, 113, .25)
    }

    .ri {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      padding: 9px 0;
      border-bottom: 1px solid var(--border)
    }

    .ri:last-child {
      border-bottom: none
    }

    .rim {
      flex: 1;
      min-width: 0
    }

    .rt {
      font-weight: 600;
      font-size: 0.82rem;
      margin-bottom: 2px
    }

    .rs {
      font-size: 0.72rem;
      color: var(--text2);
      line-height: 1.5
    }

    .ps {
      padding: 9px 13px;
      margin-bottom: 7px;
      background: rgba(34, 211, 238, .04);
      border: 1px solid rgba(34, 211, 238, .12);
      border-radius: 10px;
      border-left: 3px solid var(--cyan)
    }

    .ps-t {
      font-weight: 700;
      font-size: 0.8rem;
      margin-bottom: 3px
    }

    .ps-s {
      font-size: 0.72rem;
      color: var(--text2);
      margin-bottom: 2px
    }

    .ps-c {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.68rem;
      color: var(--cyan)
    }

    .cr {
      display: flex;
      align-items: center;
      gap: 9px;
      margin-bottom: 9px;
      font-size: 0.76rem
    }

    .cl {
      width: 100px;
      color: var(--text2);
      flex-shrink: 0
    }

    .ct {
      flex: 1;
      height: 5px;
      background: rgba(255, 255, 255, .06);
      border-radius: 3px
    }

    .cf {
      height: 100%;
      border-radius: 3px;
      transition: width .5s
    }

    .cp {
      width: 32px;
      text-align: right;
      color: var(--text1);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.7rem
    }

    .empty {
      text-align: center;
      padding: 36px 20px;
      color: var(--text3)
    }

    .empty .ico {
      font-size: 1.8rem;
      margin-bottom: 8px
    }
  </style>
</head>

<body>

  <header class="topbar">
    <div class="logo">SARE-HX</div>
    <div style="display:flex;align-items:center;gap:15px">
      <!-- Hippocampus Status Pill -->
      <div id="hip-status"
        style="display:flex;align-items:center;gap:6px;padding:4px 10px;border-radius:20px;background:rgba(52,211,153,0.1);color:var(--green);font-size:0.7rem;font-weight:600;border:1px solid rgba(52,211,153,0.2);transition:all 0.3s">
        Awake ðŸŸ¢
      </div>
      <div class="ticker">
        <span class="dot"></span>
        <span>Episodes: <span class="tick-val" id="t-ep">â€”</span></span>
        <span>Seeds: <span class="tick-val" id="t-seeds">â€”</span></span>
        <span>Concepts: <span class="tick-val" id="t-conc">â€”</span></span>
        <span>Solves: <span class="tick-val" id="t-solves">â€”</span></span>
      </div>
    </div>
  </header>

  <nav class="tab-nav">
    <button class="tb" data-tab="solve" onclick="sw('solve')">âš¡ Solve</button>
    <button class="tb" data-tab="memory" onclick="sw('memory')">ðŸ’¾ Memory</button>
    <button class="tb" data-tab="mind" onclick="sw('mind')">ðŸ§  Mind</button>
    <button class="tb" data-tab="frontier" onclick="sw('frontier')">ðŸ—º Frontier</button>
    <button class="tb" data-tab="concepts" onclick="sw('concepts')">ðŸ’¡ Concepts</button>
    <button class="tb" data-tab="curiosity" onclick="sw('curiosity')">ðŸ”­ Curiosity</button>
    <button class="tb" data-tab="checklist" onclick="sw('checklist')">ðŸ“‹ Checklist</button>
    <button class="tb" data-tab="goals" onclick="sw('goals')">ðŸŽ¯ Goals</button>
    <button class="tb" data-tab="nlp" onclick="sw('nlp')">ðŸ’¬ NL Parse</button>
    <button class="tb" data-tab="explain" onclick="sw('explain')">ðŸ”¬ Explain</button>
  </nav>

  <main>

    <!-- â•â•â• SOLVE â•â•â• -->
    <div class="tp" id="tab-solve">
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Expression Solver</div>
          <span class="badge b-c" id="conf-badge" style="display:none"></span>
        </div>
        <div class="ir">
          <input class="inp" id="expr-in" placeholder="e.g.  (x + 0) * 1  or  NOT(NOT(p))"
            onkeydown="if(event.key==='Enter')solve()">
          <button class="btn btn-p" id="solve-btn" onclick="solve()">âš¡ Solve</button>
        </div>
        <div class="chips">
          <button class="chip" onclick="se('x + 0')">x + 0</button>
          <button class="chip" onclick="se('(x+0)*(y*1)')">( x+0 )Â·( yÂ·1 )</button>
          <button class="chip" onclick="se('NOT(NOT(p))')">Â¬Â¬p</button>
          <button class="chip" onclick="se('p AND TRUE')">p âˆ§ âŠ¤</button>
          <button class="chip" onclick="se('a + (b * 1) + 0')">a+(bÂ·1)+0</button>
          <button class="chip" onclick="se('x * 0')">x Â· 0</button>
          <button class="chip" onclick="se('x - x')">x âˆ’ x</button>
          <button class="chip" onclick="se('x / x')">x Ã· x</button>
        </div>
      </div>

      <div id="solve-results" style="display:none">
        <div class="g2">
          <div class="card">
            <div class="card-hd">
              <div class="card-title">Energy</div>
              <span class="badge" id="delta-badge"></span>
            </div>
            <div class="sr">
              <div class="st">
                <div class="sv c-yellow" id="ei">â€”</div>
                <div class="sl">Before</div>
              </div>
              <div class="st">
                <div class="sv c-green" id="ef">â€”</div>
                <div class="sl">After</div>
              </div>
              <div class="st">
                <div class="sv c-cyan" id="conf-v">â€”</div>
                <div class="sl">Conf</div>
              </div>
            </div>
            <div class="ebar">
              <div class="efill" id="ebar" style="width:0"></div>
            </div>
            <div id="strat-hint" style="font-size:0.7rem;color:var(--text3);margin-top:5px"></div>
          </div>
          <div class="card">
            <div class="card-hd">
              <div class="card-title">Stats</div>
            </div>
            <div class="sr">
              <div class="st">
                <div class="sv c-purple" id="r-st">â€”</div>
                <div class="sl">Steps</div>
              </div>
              <div class="st">
                <div class="sv c-pink" id="r-ex">â€”</div>
                <div class="sl">Expand</div>
              </div>
              <div class="st">
                <div class="sv c-cyan" id="r-ms">â€”</div>
                <div class="sl">ms</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-hd">
            <div class="card-title">Transform Trace</div>
          </div>
          <div id="trace" style="display:flex;flex-wrap:wrap;gap:6px;min-height:22px"></div>
        </div>

        <div class="card" id="proof-card" style="display:none">
          <div class="card-hd">
            <div class="card-title">ðŸ“œ Step-by-Step Proof</div>
            <span class="badge b-c" id="proof-badge">0 steps</span>
          </div>
          <div id="proof-steps"></div>
          <div class="sep"></div>
          <div id="proof-concl" style="font-size:0.8rem;color:var(--text2);line-height:1.6"></div>
        </div>

        <div class="card">
          <div class="card-hd">
            <div class="card-title">Learned Rules</div>
          </div>
          <div id="learned"></div>
        </div>

        <div class="card">
          <div class="card-hd">
            <div class="card-title">Energy Breakdown</div>
          </div>
          <div id="breakdown" style="display:flex;flex-wrap:wrap;gap:10px"></div>
        </div>
      </div>
    </div>

    <!-- â•â•â• MEMORY â•â•â• -->
    <div class="tp" id="tab-memory">
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Persistent Memory</div>
          <button class="btn btn-g btn-sm" onclick="loadMem()">â†» Refresh</button>
        </div>
        <div class="sr">
          <div class="st">
            <div class="sv c-cyan" id="ms-ep">â€”</div>
            <div class="sl">Episodes</div>
          </div>
          <div class="st">
            <div class="sv c-green" id="ms-slv">â€”</div>
            <div class="sl">Solved</div>
          </div>
          <div class="st">
            <div class="sv c-purple" id="ms-rt">â€”</div>
            <div class="sl">Solve Rate</div>
          </div>
          <div class="st">
            <div class="sv c-yellow" id="ms-str">â€”</div>
            <div class="sl">Strategies</div>
          </div>
          <div class="st">
            <div class="sv c-pink" id="ms-avg">â€”</div>
            <div class="sl">Avg Î”E</div>
          </div>
          <div class="st">
            <div class="sv c-cyan" id="ms-sd">â€”</div>
            <div class="sl">Seeds</div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Recent Episodes</div>
        </div>
        <div id="ep-list">
          <div class="empty">
            <div class="ico">ðŸ’¾</div>No episodes yet.
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â• MIND â•â•â• -->
    <div class="tp" id="tab-mind">
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Self-Model / Metacognition</div>
          <button class="btn btn-g btn-sm" onclick="loadSelf()">â†» Refresh</button>
        </div>
        <div class="sr">
          <div class="st">
            <div class="sv c-cyan" id="sm-slv">â€”</div>
            <div class="sl">Solves</div>
          </div>
          <div class="st">
            <div class="sv c-green" id="sm-dom">â€”</div>
            <div class="sl">Domains</div>
          </div>
          <div class="st">
            <div class="sv c-yellow" id="sm-cal">â€”</div>
            <div class="sl">Calib Err</div>
          </div>
          <div class="st">
            <div class="sv c-purple" id="sm-pri">â€”</div>
            <div class="sl">Focus</div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Domain Competence</div>
        </div>
        <div id="dom-comp">
          <div class="empty">
            <div class="ico">ðŸ§ </div>Solve problems to build competence map.
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Curiosity Weights</div>
        </div>
        <div id="cur-wts">
          <div class="empty">
            <div class="ico">ðŸŽ¯</div>No weights yet.
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â• FRONTIER â•â•â• -->
    <div class="tp" id="tab-frontier">
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Learning Frontier (ZPD)</div>
          <button class="btn btn-g btn-sm" onclick="loadFrontier()">â†» Refresh</button>
        </div>
        <div class="sr">
          <div class="st">
            <div class="sv c-cyan" id="fr-t">â€”</div>
            <div class="sl">Total</div>
          </div>
          <div class="st">
            <div class="sv c-green" id="fr-s">â€”</div>
            <div class="sl">Solved</div>
          </div>
          <div class="st">
            <div class="sv c-red" id="fr-u">â€”</div>
            <div class="sl">Unsolved</div>
          </div>
          <div class="st">
            <div class="sv c-yellow" id="fr-r">â€”</div>
            <div class="sl">Success%</div>
          </div>
        </div>
        <div id="fr-zpd"></div>
      </div>
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Frontier Problems</div>
        </div>
        <div id="fr-list">
          <div class="empty">
            <div class="ico">ðŸ—º</div>Solve problems to populate frontier.
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â• CONCEPTS â•â•â• -->
    <div class="tp" id="tab-concepts">
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Concept Registry</div>
          <button class="btn btn-g btn-sm" onclick="loadConcepts()">â†» Refresh</button>
        </div>
        <div class="sr">
          <div class="st">
            <div class="sv c-cyan" id="cc-t">â€”</div>
            <div class="sl">Rules</div>
          </div>
          <div class="st">
            <div class="sv c-green" id="cc-a">â€”</div>
            <div class="sl">Active</div>
          </div>
          <div class="st">
            <div class="sv c-purple" id="cc-d">â€”</div>
            <div class="sl">Domains</div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Rules</div>
          <input id="cc-filter" class="inp" style="width:200px;padding:5px 11px;font-size:0.76rem"
            placeholder="Filter..." oninput="filterC()">
        </div>
        <div id="cc-list">
          <div class="empty">
            <div class="ico">ðŸ’¡</div>Loadingâ€¦
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â• CURIOSITY â•â•â• -->
    <div class="tp" id="tab-curiosity">
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Curiosity Engine</div>
          <div style="display:flex;gap:7px">
            <button class="btn btn-g btn-sm" onclick="loadCur()">â†» Refresh</button>
            <button class="btn btn-p btn-sm" onclick="genProbs()">Generate</button>
          </div>
        </div>
        <div class="sr">
          <div class="st">
            <div class="sv c-cyan" id="cu-p">â€”</div>
            <div class="sl">Pending</div>
          </div>
          <div class="st">
            <div class="sv c-green" id="cu-s">â€”</div>
            <div class="sl">Solved</div>
          </div>
          <div class="st">
            <div class="sv c-purple" id="cu-t">â€”</div>
            <div class="sl">Generated</div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Problem Queue</div>
        </div>
        <div id="cu-list">
          <div class="empty">
            <div class="ico">ðŸ”­</div>Click Generate.
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â• CHECKLIST â•â•â• -->
    <div class="tp" id="tab-checklist">
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Engineering Checklist</div>
          <button class="btn btn-g btn-sm" onclick="loadCheck()">â†» Refresh</button>
        </div>
        <div id="cl-content">
          <div class="empty">
            <div class="ico">ðŸ“‹</div>Loadingâ€¦
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â• GOALS â•â•â• -->
    <div class="tp" id="tab-goals">
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Autonomous Goal Stack</div>
          <button class="btn btn-g btn-sm" onclick="loadGoals()">â†» Refresh</button>
        </div>
        <div class="sr">
          <div class="st">
            <div class="sv c-cyan" id="g-act">â€”</div>
            <div class="sl">Active</div>
          </div>
          <div class="st">
            <div class="sv c-green" id="g-ach">â€”</div>
            <div class="sl">Achieved</div>
          </div>
        </div>
        <div id="next-goal"
          style="display:none;padding:11px 14px;border-radius:10px;background:rgba(34,211,238,.06);border:1px solid rgba(34,211,238,.2);margin-bottom:12px">
          <div
            style="font-size:0.66rem;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px">
            Next Goal</div>
          <div id="ng-txt" style="font-weight:600;color:var(--cyan)"></div>
          <div class="pw" style="margin-top:7px">
            <div class="pb" id="ng-prog"></div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Goals</div>
        </div>
        <div id="g-list">
          <div class="empty">
            <div class="ico">ðŸŽ¯</div>Solve problems to auto-generate goals.
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â• NL PARSE â•â•â• -->
    <div class="tp" id="tab-nlp">
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Natural Language â†’ Expression</div>
        </div>
        <div class="ir">
          <input class="inp" id="nl-in" placeholder="e.g. x plus zero times one"
            onkeydown="if(event.key==='Enter')nlParse()">
          <button class="btn btn-p" onclick="nlParse()">Parse â†’</button>
        </div>
        <div class="chips">
          <button class="chip" onclick="sn('x plus zero')">x plus zero</button>
          <button class="chip" onclick="sn('x times one')">x times one</button>
          <button class="chip" onclick="sn('x minus x')">x minus x</button>
          <button class="chip" onclick="sn('not not x')">not not x</button>
          <button class="chip" onclick="sn('p and true')">p and true</button>
          <button class="chip" onclick="sn('three plus four')">3 + 4</button>
        </div>
      </div>
      <div class="card" id="nl-card" style="display:none">
        <div class="card-hd">
          <div class="card-title">Parse Result</div>
        </div>
        <div class="sr">
          <div class="st" style="flex:2">
            <div class="sv c-cyan" id="nl-expr" style="font-size:1rem;font-family:'JetBrains Mono',monospace">â€”</div>
            <div class="sl">Expression</div>
          </div>
          <div class="st">
            <div class="sv c-green" id="nl-conf">â€”</div>
            <div class="sl">Confidence</div>
          </div>
          <div class="st">
            <div class="sv c-purple" id="nl-dom">â€”</div>
            <div class="sl">Domain</div>
          </div>
        </div>
        <div id="nl-warn" style="margin-bottom:10px"></div>
        <button class="btn btn-p btn-sm" onclick="nlSolve()">âš¡ Solve This</button>
      </div>
    </div>

    <!-- â•â•â• EXPLAIN â•â•â• -->
    <div class="tp" id="tab-explain">
      <div class="card">
        <div class="card-hd">
          <div class="card-title">ðŸ”¬ Abductive Reasoner</div>
        </div>
        <p style="font-size:0.78rem;color:var(--text2);margin-bottom:13px">Given an observed solve outcome, SARE
          explains <em>why</em> those transforms worked â€” inference to the best explanation.</p>
        <div class="g2" style="gap:9px;margin-bottom:9px">
          <div>
            <div style="font-size:0.7rem;color:var(--text3);margin-bottom:4px">Transforms (comma-separated)</div>
            <input class="inp" id="ex-tr" placeholder="additive_identity, multiplicative_identity">
          </div>
          <div>
            <div style="font-size:0.7rem;color:var(--text3);margin-bottom:4px">Energy delta</div>
            <input class="inp" id="ex-d" placeholder="4.2" type="number" step="0.1">
          </div>
        </div>
        <div style="display:flex;gap:9px;align-items:center">
          <select id="ex-dom" class="inp" style="width:170px;padding:8px 11px">
            <option value="general">general</option>
            <option value="arithmetic">arithmetic</option>
            <option value="logic">logic</option>
            <option value="algebra">algebra</option>
            <option value="sets">sets</option>
            <option value="code">code</option>
          </select>
          <button class="btn btn-p" onclick="runExplain()">ðŸ”¬ Explain</button>
          <button class="btn btn-g btn-sm" onclick="useLastSolve()">Use Last Solve</button>
        </div>
      </div>
      <div id="ex-results" style="display:none">
        <div class="card">
          <div class="card-hd">
            <div class="card-title">Best Explanation</div>
            <span class="badge b-c" id="ex-conf-lbl"></span>
          </div>
          <div id="ex-best"></div>
        </div>
        <div class="card">
          <div class="card-hd">
            <div class="card-title">All Hypotheses</div>
          </div>
          <div id="ex-hyps"></div>
        </div>
      </div>
    </div>

  </main>

  <script>
// â”€â”€ state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var _last = null, _nlExpr = '';
var _allConcepts = [];

// â”€â”€ tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sw(name) {
  document.querySelectorAll('.tb').forEach(b => b.classList.toggle('active', b.dataset.tab === name));
  document.querySelectorAll('.tp').forEach(p => p.classList.toggle('active', p.id === 'tab-' + name));
  ({memory:loadMem, mind:loadSelf, frontier:loadFrontier, concepts:loadConcepts,
    curiosity:loadCur, checklist:loadCheck, goals:loadGoals})[name]?.();
}

// â”€â”€ fetch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function api(path, opts) {
  try {
    var r = await fetch(path, opts);
    if (!r.ok) return null;
    return await r.json();
  } catch(e) { console.warn(path, e); return null; }
}
function fe(v) { return v != null ? Number(v).toFixed(3) : 'â€”'; }
function fp(v) { return v != null ? Number(v).toFixed(1)+'%' : 'â€”'; }
function se(v) { document.getElementById('expr-in').value = v; }
function sn(v) { document.getElementById('nl-in').value = v; }

// â”€â”€ ticker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function tick() {
  var h = await api('/api/hippocampus/status');
  if (h) {
    var hs = document.getElementById('hip-status');
    if (h.state === 'sleeping') {
      hs.innerHTML = 'Sleeping: ' + h.current_task + ' ðŸŒ™';
      hs.style.background = 'rgba(167,139,250,0.1)';
      hs.style.color = 'var(--purple)';
      hs.style.borderColor = 'rgba(167,139,250,0.2)';
      hs.style.boxShadow = '0 0 10px rgba(167,139,250,0.2)';
    } else {
      hs.innerHTML = 'Awake ðŸŸ¢';
      hs.style.background = 'rgba(52,211,153,0.1)';
      hs.style.color = 'var(--green)';
      hs.style.borderColor = 'rgba(52,211,153,0.2)';
      hs.style.boxShadow = 'none';
    }
  }

  var m = await api('/api/memory/stats');
  if (m && m.stats) {
    document.getElementById('t-ep').textContent    = m.stats.total_episodes ?? 'â€”';
    document.getElementById('t-seeds').textContent = m.seeds_loaded ?? 'â€”';
    document.getElementById('t-conc').textContent  = m.concept_count ?? 'â€”';
  }
  var s = await api('/api/self');
  if (s) document.getElementById('t-solves').textContent = s.total_solves ?? 'â€”';
}

// â”€â”€ solve â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function solve() {
  var expr = document.getElementById('expr-in').value.trim();
  if (!expr) return;
  var btn = document.getElementById('solve-btn');
  btn.classList.add('ld'); btn.textContent = 'â€¦';
  document.getElementById('solve-results').style.display = 'none';

  var d = await api('/api/solve', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({expression: expr})
  });
  btn.classList.remove('ld'); btn.textContent = 'âš¡ Solve';
  if (!d) return;
  
  if (d.status === 'needs_help') {
    showQuestionModal(d);
    return;
  }
  
  _last = d;
  renderSolve(d);
  tick();
}

function renderSolve(d) {
  document.getElementById('solve-results').style.display = '';
  var iE = d.initial?.energy?.total ?? 0;
  var fE = d.result?.energy?.total  ?? 0;
  var delta = iE - fE;
  var pct   = iE > 0 ? delta/iE*100 : 0;

  document.getElementById('ei').textContent     = fe(iE);
  document.getElementById('ef').textContent     = fe(fE);
  document.getElementById('conf-v').textContent = d.confidence != null ? fp(d.confidence*100) : 'â€”';

  var db = document.getElementById('delta-badge');
  if (delta > 0.01) {
    db.textContent = 'âˆ’'+delta.toFixed(3)+' ('+pct.toFixed(1)+'%)';
    db.className = 'badge b-g';
  } else { db.textContent = 'No reduction'; db.className = 'badge b-r'; }

  document.getElementById('ebar').style.width = Math.min(pct,100)+'%';
  document.getElementById('r-st').textContent  = d.steps_taken ?? d.result?.steps ?? 'â€”';
  document.getElementById('r-ex').textContent  = d.expansions  ?? d.result?.expansions ?? 'â€”';
  var ms = d.elapsed_seconds != null ? (d.elapsed_seconds*1000).toFixed(1) : 'â€”';
  document.getElementById('r-ms').textContent  = ms;

  var cb = document.getElementById('conf-badge');
  if (d.confidence != null) { cb.textContent = 'Confidence: '+(d.confidence*100).toFixed(0)+'%'; cb.style.display=''; }

  document.getElementById('strat-hint').textContent = d.strategy_hit ? 'âœ… Memory hit â€” warm-started from similar past solve' : '';

  var tr = document.getElementById('trace');
  var transforms = d.transforms_applied ?? d.result?.transforms ?? [];
  tr.innerHTML = transforms.length
    ? transforms.map(t => '<span class="tc'+(t.startsWith('concept_')?' concept':'')+'">' + t + '</span>').join('')
    : '<span style="color:var(--text3);font-size:0.75rem">Identity â€” no transforms applied</span>';

  // Proof
  var pc = document.getElementById('proof-card');
  if (d.proof) {
    var proof = d.proof;
    var steps = proof.steps ?? [];
    document.getElementById('proof-badge').textContent = steps.length + ' steps';
    document.getElementById('proof-steps').innerHTML = steps.length
      ? steps.map(s => '<div class="ps"><div class="ps-t">Step '+s.step+'. '+s.rule_name+'</div><div class="ps-s">'+s.explanation+'</div><div class="ps-c">'+s.detail+'</div></div>').join('')
      : '<div style="color:var(--text3);font-size:0.8rem;padding:8px 0">Expression already in its simplest form.</div>';
    document.getElementById('proof-concl').textContent = proof.conclusion ?? '';
    pc.style.display = '';
  } else { pc.style.display = 'none'; }

  // Learned
  var ll = document.getElementById('learned');
  var rules = d.learned_concepts ?? [];
  ll.innerHTML = rules.length
    ? rules.map(r => '<div class="ri"><div class="rim"><div class="rt" style="color:var(--pink);font-family:monospace">'+r.name+'</div><div class="rs">Domain: '+r.domain+' Â· Conf: '+((r.confidence??0)*100).toFixed(0)+'%</div></div><span class="badge '+(r.promoted?'b-g':'b-y')+'">'+(r.promoted?'Promoted':'Rejected')+'</span></div>').join('')
    : '<div class="empty"><div class="ico">ðŸ’¡</div>No new rules from this solve.</div>';

  // Breakdown
  var bd = document.getElementById('breakdown');
  var comps = d.initial?.energy?.components ?? {};
  bd.innerHTML = Object.entries(comps).filter(([,v])=>v>0)
    .map(([k,v]) => '<div style="text-align:center;padding:9px 13px;background:var(--glass);border:1px solid var(--border);border-radius:10px"><div style="font-family:monospace;font-size:.95rem;font-weight:700;color:var(--cyan)">'+v.toFixed(3)+'</div><div style="font-size:.63rem;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-top:3px">'+k+'</div></div>').join('')
    || '<span style="color:var(--text3);font-size:.78rem">No components</span>';
}

// â”€â”€ memory â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadMem() {
  var d = await api('/api/memory/stats');
  if (!d) return;
  var s = d.stats ?? {};
  document.getElementById('ms-ep').textContent  = s.total_episodes ?? 'â€”';
  document.getElementById('ms-slv').textContent = s.solved ?? 'â€”';
  document.getElementById('ms-rt').textContent  = s.solve_rate != null ? fp(s.solve_rate*100) : 'â€”';
  document.getElementById('ms-str').textContent = s.strategy_count ?? 'â€”';
  document.getElementById('ms-avg').textContent = s.avg_energy_saved != null ? s.avg_energy_saved.toFixed(2) : 'â€”';
  document.getElementById('ms-sd').textContent  = d.seeds_loaded ?? 'â€”';
  var el = document.getElementById('ep-list');
  var eps = d.recent_episodes ?? [];
  el.innerHTML = eps.length
    ? eps.map(e => '<div class="ri"><div class="rim"><div class="rt" style="font-family:monospace">'+e.problem_id+'</div><div class="rs">Î”E '+(e.energy_delta?.toFixed(3)??'â€”')+' Â· '+(e.elapsed_ms?.toFixed(1)??'â€”')+'ms Â· '+(e.steps??0)+' steps</div></div><span class="badge '+(e.success?'b-g':'b-r')+'">'+(e.success?'âœ“':'âœ—')+'</span></div>').join('')
    : '<div class="empty"><div class="ico">ðŸ’¾</div>No episodes yet.</div>';
}

// â”€â”€ self-model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadSelf() {
  var d = await api('/api/self');
  if (!d) return;
  document.getElementById('sm-slv').textContent = d.total_solves ?? 'â€”';
  document.getElementById('sm-dom').textContent = Object.keys(d.domains ?? {}).length;
  document.getElementById('sm-cal').textContent = d.calibration_error != null ? d.calibration_error.toFixed(3) : 'â€”';
  document.getElementById('sm-pri').textContent = d.prioritized_domain ?? 'â€”';
  var dc = document.getElementById('dom-comp');
  var doms = d.domains ?? {};
  dc.innerHTML = Object.entries(doms).length
    ? Object.entries(doms).map(([name, info]) => {
        var r = ((info.solve_rate??0)*100).toFixed(0);
        var col = r>=70?'var(--green)':r>=40?'var(--yellow)':'var(--red)';
        return '<div class="cr"><div class="cl">'+name+'</div><div class="ct"><div class="cf" style="width:'+r+'%;background:'+col+'"></div></div><div class="cp">'+r+'%</div><span class="badge '+(r>=70?'b-g':r>=40?'b-y':'b-r')+'" style="margin-left:7px">'+(info.mastery_level??'')+'</span></div>';
      }).join('')
    : '<div class="empty"><div class="ico">ðŸ§ </div>Solve problems to build competence map.</div>';
  var cw = document.getElementById('cur-wts');
  var wts = d.curiosity_weights ?? {};
  var tot = Object.values(wts).reduce((a,b)=>a+b,0)||1;
  cw.innerHTML = Object.entries(wts).length
    ? Object.entries(wts).map(([k,v]) => '<div class="cr"><div class="cl">'+k+'</div><div class="ct"><div class="cf" style="width:'+(v/tot*100).toFixed(0)+'%;background:var(--purple)"></div></div><div class="cp">'+(v/tot*100).toFixed(0)+'%</div></div>').join('')
    : '<div class="empty"><div class="ico">ðŸŽ¯</div>No weights yet.</div>';
}

// â”€â”€ frontier â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadFrontier() {
  var d = await api('/api/frontier');
  if (!d) return;
  document.getElementById('fr-t').textContent = d.total   ?? 'â€”';
  document.getElementById('fr-s').textContent = d.solved  ?? 'â€”';
  document.getElementById('fr-u').textContent = d.unsolved ?? 'â€”';
  document.getElementById('fr-r').textContent = d.success_rate != null ? fp(d.success_rate*100) : 'â€”';
  document.getElementById('fr-zpd').innerHTML = d.zpd_domain
    ? '<span class="badge b-c" style="font-size:.75rem;padding:4px 11px">ZPD Focus: '+d.zpd_domain+'</span>'
    : '';
  var fl = document.getElementById('fr-list');
  var items = (d.recent_attempts ?? []).slice(0,15);
  fl.innerHTML = items.length
    ? items.map(p => '<div class="ri"><div class="rim"><div class="rt" style="font-family:monospace">'+p.problem_id+'</div><div class="rs">Î”E '+(p.delta?.toFixed(3)??'â€”')+' Â· '+(p.num_transforms??0)+' transforms</div></div><span class="badge '+(p.success?'b-g':'b-r')+'">'+(p.success?'Solved':'Failed')+'</span></div>').join('')
    : '<div class="empty"><div class="ico">ðŸ—º</div>Frontier empty â€” solve more problems.</div>';
}

// â”€â”€ concepts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadConcepts() {
  var d = await api('/api/concepts');
  if (!d) return;
  var rules = d.rules ?? (Array.isArray(d) ? d : []);
  _allConcepts = rules;
  document.getElementById('cc-t').textContent = rules.length;
  document.getElementById('cc-a').textContent = rules.filter(r=>r.active!==false).length;
  var doms = new Set(rules.map(r=>r.domain).filter(Boolean));
  document.getElementById('cc-d').textContent = doms.size;
  renderC(rules);
}
function filterC() {
  var q = document.getElementById('cc-filter').value.toLowerCase();
  renderC(_allConcepts.filter(r=>(r.name+r.domain+(r.description??'')).toLowerCase().includes(q)));
}
function renderC(list) {
  document.getElementById('cc-list').innerHTML = list.length
    ? list.map(r => '<div class="ri"><div class="rim"><div class="rt" style="font-family:monospace;color:var(--pink)">'+r.name+'</div><div class="rs">'+( r.domain??'')+ ' Â· Conf: '+((r.confidence??1)*100).toFixed(0)+'%'+(r.pattern_description?' Â· '+r.pattern_description+' â†’ '+(r.replacement_description??''):'')+'</div></div><span class="badge '+(r.active!==false?'b-g':'b-r')+'">'+(r.active!==false?'On':'Off')+'</span></div>').join('')
    : '<div class="empty"><div class="ico">ðŸ’¡</div>No concepts found.</div>';
}

// â”€â”€ curiosity â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadCur() {
  var d = await api('/api/curiosity');
  if (!d) return;
  document.getElementById('cu-p').textContent = d.pending_count  ?? 'â€”';
  document.getElementById('cu-s').textContent = d.solved_count   ?? 'â€”';
  document.getElementById('cu-t').textContent = d.total_generated ?? 'â€”';
  var items = (d.problems ?? []).slice(0,20);
  document.getElementById('cu-list').innerHTML = items.length
    ? items.map(p => { 
        return '<div class="ri"><div class="rim"><div class="rt" style="font-family:monospace">[curiosity:'+p.id+']</div><div class="rs">Origin: '+p.origin+' Â· Nodes: '+p.nodes+'</div></div><button class="btn btn-g btn-sm" onclick="solveCuriosity(\''+p.id+'\', this)">Solve â†’</button></div>'; 
      }).join('')
    : '<div class="empty"><div class="ico">ðŸ”­</div>No pending problems.</div>';
}
async function genProbs() {
  await api('/api/curiosity/generate', {method:'POST', headers:{'Content-Type':'application/json'}, body:'{}'});
  loadCur();
}

async function solveCuriosity(id, btn) {
  var ogText = btn.textContent;
  btn.classList.add('ld'); btn.textContent = 'â€¦';
  var d = await api('/api/curiosity/solve', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({id: id})
  });
  btn.classList.remove('ld'); btn.textContent = ogText;
  if (d && !d.error) {
    _last = d;
    renderSolve(d);
    sw('solve'); 
    se(d.expression || '[curiosity:'+id+']');
    tick();
    loadCur();
  } else if (d && d.error) {
    alert("Curiosity Solve Error: " + d.error);
  }
}

// â”€â”€ checklist â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadCheck() {
  var d = await api('/api/engineering_checklist');
  if (!d) return;
  var el = document.getElementById('cl-content');
  var secs = d.sections ?? [];
  if (!secs.length) {
    el.innerHTML = '<pre style="font-size:.72rem;color:var(--text2);white-space:pre-wrap">'+JSON.stringify(d,null,2)+'</pre>';
    return;
  }
  el.innerHTML = secs.map(s => '<div style="margin-bottom:14px"><div class="card-title" style="margin-bottom:7px">'+(s.name??s.title??'')+'</div>'
    +(s.items??[]).map(item => '<div class="ri"><div class="rim"><div class="rt">'+(item.name??item.description??item)+'</div>'+(item.description?'<div class="rs">'+item.description+'</div>':'')+'</div><span class="badge '+(item.status==='done'||item.complete?'b-g':item.status==='partial'?'b-y':'b-r')+'">'+(item.status??'pending')+'</span></div>').join('')+'</div>').join('<div class="sep"></div>');
}

// â”€â”€ goals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadGoals() {
  var d = await api('/api/goals');
  if (!d || d.error) return;
  document.getElementById('g-act').textContent = d.active_count   ?? 'â€”';
  document.getElementById('g-ach').textContent = d.achieved_count ?? 'â€”';
  var nb = document.getElementById('next-goal');
  if (d.next_goal) {
    nb.style.display = '';
    document.getElementById('ng-txt').textContent = d.next_goal.description ?? '';
    document.getElementById('ng-prog').style.width = ((d.next_goal.progress??0)*100).toFixed(0)+'%';
  } else { nb.style.display = 'none'; }
  var goals = d.active_goals ?? [];
  document.getElementById('g-list').innerHTML = goals.length
    ? goals.map(g => '<div class="ri"><div class="rim"><div class="rt">'+g.description+'</div><div class="rs">Priority: '+g.priority+' Â· Domain: '+(g.domain??'system')+' Â· '+Math.round((g.progress??0)*100)+'% complete</div><div class="pw" style="margin-top:5px"><div class="pb" style="width:'+Math.round((g.progress??0)*100)+'%"></div></div></div><span class="badge b-c">'+(g.type??'').replace(/_/g,' ')+'</span></div>').join('')
    : '<div class="empty"><div class="ico">ðŸŽ¯</div>Solve problems to auto-generate goals.</div>';
}

// â”€â”€ nl parser â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function nlParse() {
  var text = document.getElementById('nl-in').value.trim();
  if (!text) return;
  var d = await api('/api/parse?q=' + encodeURIComponent(text));
  if (!d || d.error) return;
  _nlExpr = d.expression;
  document.getElementById('nl-expr').textContent = d.expression || '(empty)';
  document.getElementById('nl-conf').textContent = d.confidence != null ? fp(d.confidence*100) : 'â€”';
  document.getElementById('nl-dom').textContent  = d.domain || 'â€”';
  document.getElementById('nl-warn').innerHTML   = (d.warnings??[]).map(w=>'<div style="font-size:.72rem;color:var(--yellow);margin-bottom:3px">âš  '+w+'</div>').join('');
  document.getElementById('nl-card').style.display = '';
}
async function nlSolve() {
  if (!_nlExpr) return;
  se(_nlExpr); sw('solve'); solve();
}

// â”€â”€ explain â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function runExplain() {
  var transforms = document.getElementById('ex-tr').value.split(',').map(s=>s.trim()).filter(Boolean);
  var delta  = parseFloat(document.getElementById('ex-d').value) || 0;
  var domain = document.getElementById('ex-dom').value;
  var d = await api('/api/explain', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({transforms, delta, domain, top_k:5})
  });
  if (!d) return;
  document.getElementById('ex-results').style.display = '';
  document.getElementById('ex-conf-lbl').textContent = 'confidence: ' + (d.confidence_level ?? 'â€”');
  var best = d.best_explanation;
  document.getElementById('ex-best').innerHTML = best
    ? '<div class="ps"><div class="ps-t">'+best.name+'</div><div class="ps-s">Domain: '+best.domain+' Â· Posterior: '+(best.posterior*100).toFixed(0)+'% Â· Action: '+best.recommended_action+'</div>'+(best.reasoning_chain??[]).map(l=>'<div class="ps-c" style="margin-top:2px">'+l+'</div>').join('')+'</div>'
    : 'â€”';
  document.getElementById('ex-hyps').innerHTML = (d.hypotheses??[]).map((h,i)=>'<div class="ri"><div class="rim"><div class="rt">'+( i+1)+'. '+h.name+'</div><div class="rs">Posterior: '+(h.posterior*100).toFixed(0)+'% Â· Occam: '+h.occam_score.toFixed(3)+' Â· '+h.domain+'</div></div><span class="badge '+(h.recommended_action==='accept'?'b-g':h.recommended_action==='verify'?'b-y':'b-r')+'">'+h.recommended_action+'</span></div>').join('');
}
function useLastSolve() {
  if (!_last) return;
  document.getElementById('ex-tr').value = (_last.transforms_applied??[]).join(', ');
  document.getElementById('ex-d').value  = _last.delta ?? 0;
  runExplain();
}

// â”€â”€ active metacognitive questioning â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _currentQuestion = null;
function showQuestionModal(d) {
  _currentQuestion = d;
  document.getElementById('q-text').textContent = d.question_data.question;
  document.getElementById('q-ans').value = '';
  document.getElementById('q-err').style.display = 'none';
  var m = document.getElementById('q-modal');
  m.style.display = 'flex';
  setTimeout(() => document.getElementById('q-ans').focus(), 100);
}

async function submitAnswer() {
  if (!_currentQuestion) return;
  var ans = document.getElementById('q-ans').value.trim();
  if (!ans) return;
  
  var btn = document.getElementById('q-submit');
  btn.classList.add('ld'); btn.textContent = 'â€¦';
  
  var d = await api('/api/teach', {
    method: 'POST', headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      rule_text: ans,
      domain: _currentQuestion.question_data.domain
    })
  });
  
  btn.classList.remove('ld'); btn.textContent = 'Teach & Resume';
  
  if (!d || d.error) {
    var err = document.getElementById('q-err');
    err.textContent = d?.error || 'Failed to learn rule.';
    err.style.display = '';
    return;
  }
  
  document.getElementById('q-modal').style.display = 'none';
  // Resume the solve now that we know the rule
  solve();
}

document.addEventListener('DOMContentLoaded', () => {
  sw('solve');
  tick();
  setInterval(tick, 5000);
});
  </script>

  <!-- â•â•â• QUESTION MODAL â•â•â• -->
  <div id="q-modal"
    style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:9999;align-items:center;justify-content:center;backdrop-filter:blur(8px)">
    <div
      style="background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:30px;width:500px;max-width:90%;box-shadow:0 10px 40px rgba(0,0,0,0.5)">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px">
        <div
          style="width:40px;height:40px;border-radius:20px;background:var(--glass-hov);display:flex;align-items:center;justify-content:center;font-size:1.4rem">
          ðŸ¤”</div>
        <div>
          <div style="font-size:1.1rem;font-weight:600;color:var(--text)">SARE has a question</div>
          <div style="font-size:0.8rem;color:var(--text3)">Active Metacognitive Learning</div>
        </div>
      </div>
      <div id="q-text"
        style="font-size:0.95rem;color:var(--text2);margin-bottom:20px;line-height:1.5;background:var(--glass);padding:15px;border-radius:8px;border-left:3px solid var(--purple)">
      </div>
      <div style="margin-bottom:15px">
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:6px;text-transform:uppercase;letter-spacing:1px">
          Teach SARE the Rule</div>
        <input type="text" id="q-ans" class="inp" placeholder="e.g. A and false is false"
          style="width:100%;font-size:0.9rem" onkeydown="if(event.key==='Enter') submitAnswer()">
        <div id="q-err" style="color:var(--red);font-size:0.75rem;margin-top:6px;display:none"></div>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:25px">
        <button class="btn btn-n"
          onclick="document.getElementById('q-modal').style.display='none'; document.getElementById('solve-btn').textContent='âš¡ Solve'; document.getElementById('solve-btn').classList.remove('ld');">Cancel</button>
        <button class="btn btn-p" id="q-submit" onclick="submitAnswer()">Teach & Resume</button>
      </div>
    </div>
  </div>
</body>

</html>